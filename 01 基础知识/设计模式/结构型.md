## ç»“æ„å‹æ¨¡å¼

- **æœ¬æ–‡ä½œè€…ï¼š** MrBird
- **æœ¬æ–‡é“¾æ¥ï¼š** http://mrbird.cc/Javaè®¾è®¡æ¨¡å¼.html
- **æœ¬æ–‡ä»…ä¸ºä¸ªäººå­¦ä¹ æ•´ç†è½¬è½½**


### å¤–è§‚æ¨¡å¼

å¤–è§‚æ¨¡å¼åˆå«é—¨é¢æ¨¡å¼ï¼Œæä¾›äº†ç»Ÿä¸€å¾—æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚

é€‚ç”¨äºï¼š

1. å­ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ å¤–è§‚æ¨¡å¼æä¾›ç®€å•æ¥å£è°ƒç”¨ï¼›
2. æ„å»ºå¤šå±‚ç³»ç»Ÿç»“æ„ï¼Œåˆ©ç”¨å¤–è§‚å¯¹è±¡ä½œä¸ºæ¯å±‚çš„å…¥å£ï¼Œç®€åŒ–å±‚é—´è°ƒç”¨ã€‚

ä¼˜ç‚¹ï¼š

1. ç®€åŒ–äº†è°ƒç”¨è¿‡ç¨‹ï¼Œæ— éœ€äº†è§£æ·±å…¥å­ç³»ç»Ÿï¼›
2. å‡ä½è€¦åˆåº¦ï¼›
3. æ›´å¥½çš„å±‚æ¬¡åˆ’åˆ†ï¼›
4. ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ã€‚

ç¼ºç‚¹ï¼š

1. å¢åŠ å­ç³»ç»Ÿï¼Œæ‹“å±•å­ç³»ç»Ÿè¡Œä¸ºå®¹æ˜“å¼•å…¥é£é™©ï¼›
2. ä¸ç¬¦åˆå¼€é—­åŸåˆ™ã€‚

ä¸¾ä¸ªè®¢å¤–å–çš„ä¾‹å­ã€‚

åˆ›å»ºä¸€ä¸ªå¤–å–å®ä½“ç±»Takeawayï¼š

```
public class Takeaway {

    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```



è®¢å¤–å–è¿‡ç¨‹ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šä¸‹å•ã€æ”¯ä»˜å’Œé…é€ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªServiceå¯¹åº”è¿™ä¸‰ä¸ªè¿‡ç¨‹ã€‚æ–°å»ºä¸‹å•æœåŠ¡OrderServiceï¼š

```
public class OrderService {

    public boolean placeAnOrder(Takeaway takeaway) {
        System.out.println(takeaway.getName() + "ä¸‹å•æˆåŠŸ");
        return true;
    }
}
```



æ–°å»ºæ”¯ä»˜æœåŠ¡PayServiceï¼š

```
public class PayService {

    public boolean pay(Takeaway takeaway) {
        System.out.println("å•†å“" + takeaway.getName() + "æ”¯ä»˜æˆåŠŸ");
        return true;
    }
}
```



æ–°å»ºé…é€æœåŠ¡DeliveryServiceï¼š

```
public class DeliveryService {

    public void delivery(Takeaway takeaway) {
        System.out.println(takeaway.getName() + "å·²ç”±éª‘æ‰‹XXæ¥å•ï¼Œè®¢å•æ´¾é€ä¸­");
    }
}
```



åŸºäºå¤–è§‚æ¨¡å¼æ³•åˆ™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªServiceæ¥èšåˆè¿™ä¸‰ä¸ªæœåŠ¡ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å’Œè¿™ä¸ªServiceäº¤äº’å³å¯ã€‚æ–°å»ºå¤–å–æœåŠ¡TakeawayServiceï¼š

```
public class TakeawayService {

    private OrderService orderService = new OrderService();
    private PayService payService = new PayService();
    private DeliveryService deliveryService = new DeliveryService();

    public void takeOrder(Takeaway takeaway) {
        if (orderService.placeAnOrder(takeaway)) {
            if (payService.pay(takeaway)) {
                deliveryService.delivery(takeaway);
            }
        }
    }
}
```



æ–°å»ºä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸€æ³¢ï¼š

```
public class Application {

    public static void main(String[] args) {
        Takeaway takeaway = new Takeaway();
        takeaway.setName("æ³¡æ¤’ğŸ¸");

        TakeawayService takeawayService = new TakeawayService();
        takeawayService.takeOrder(takeaway);
    }
}
```



å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è°ƒç”¨TakeawayServiceå³å¯ï¼Œæ— éœ€å…³ç³»å†…éƒ¨å…·ä½“ç»å†äº†å¤šå°‘ä¸ªæ­¥éª¤ï¼Œè¿è¡Œmainæ–¹æ³•è¾“å‡ºå¦‚ä¸‹ï¼š

```
æ³¡æ¤’ğŸ¸ä¸‹å•æˆåŠŸ
å•†å“æ³¡æ¤’ğŸ¸æ”¯ä»˜æˆåŠŸ
æ³¡æ¤’ğŸ¸å·²ç”±éª‘æ‰‹XXæ¥å•ï¼Œè®¢å•æ´¾é€ä¸­
```



è¯¥ä¾‹å­çš„UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![QQæˆªå›¾20191218151629.png](https://mrbird.cc/img/QQ%E6%88%AA%E5%9B%BE20191218151629.png)

### è£…é¥°è€…æ¨¡å¼

åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°†åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œæä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆã€‚

é€‚ç”¨äºï¼š

1. æ‹“å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼›
2. åŠ¨æ€ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œå¹¶ä¸”åŠ¨æ€æ’¤é”€ã€‚

ä¼˜ç‚¹ï¼š

1. ç»§æ‰¿çš„æœ‰åŠ›è¡¥å……ï¼Œä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ç»™å¯¹è±¡æ‹“å±•åŠŸèƒ½ï¼›
2. é€šè¿‡ä½¿ç”¨ä¸åŒçš„è£…é¥°ç±»ã€ä¸åŒçš„ç»„åˆæ–¹å¼ï¼Œå®ç°ä¸åŒçš„æ•ˆæœã€‚
3. ç¬¦åˆå¼€é—­åŸåˆ™ã€‚

ç¼ºç‚¹ï¼š

1. å¢åŠ ç¨‹åºå¤æ‚æ€§ï¼›

ä¸¾ä¸ªæ°´æœæ²™æ‹‰çš„ä¾‹å­ã€‚

æ¯”å¦‚åœ¨ç‚¹æ°´æœæ²™æ‹‰å¤–å–æ—¶ï¼Œå¯ä»¥å¾€æ°´æœæ²™æ‹‰é‡ŒåŠ å„ç§æ°´æœï¼Œä»·æ ¼ä¹Ÿä¼šç›¸åº”çš„è°ƒæ•´ï¼Œè¦è®©ç¨‹åºæ”¯æŒä¸åŒæ°´æœè‡ªç”±ç»„åˆï¼Œå¹¶è®¡ç®—ç›¸åº”çš„ä»·æ ¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥å®Œæˆã€‚

å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„æ°´æœæ²™æ‹‰ç±»AbstractFruitSaladï¼š

```
public abstract class AbstractFruitSalad {
    public abstract String remark();
    public abstract int price();
}
```



åŒ…å«å¤‡æ³¨å’Œä»·æ ¼æŠ½è±¡æ–¹æ³•ã€‚

æ¥ç€åˆ›å»ºä¸€ä¸ªæŠ½è±¡çš„è£…é¥°å™¨AbstractDecoratorï¼ˆå…³é”®ç‚¹ï¼Œç»§æ‰¿æŠ½è±¡æ°´æœæ²™æ‹‰ç±»ï¼‰ï¼š

```
public class AbstractDecorator extends AbstractFruitSalad{

    private AbstractFruitSalad fruitSalad;

    public AbstractDecorator(AbstractFruitSalad fruitSalad){
        this.fruitSalad = fruitSalad;
    }

    @Override
    public String remark() {
        return fruitSalad.remark();
    }

    @Override
    public int price() {
        return fruitSalad.price();
    }
}
```



åˆ›å»ºå…·ä½“çš„æ°´æœæ²™æ‹‰ç±»FruitSaladï¼š

```
public class FruitSalad extends AbstractFruitSalad{
    @Override
    public String remark() {
        return "æ°´æœğŸ¥—ï¼ˆæ ‡å‡†ï¼‰\n";
    }

    @Override
    public int price() {
        return 9;
    }
}
```



è¯¥æ²™æ‹‰æ˜¯æ ‡å‡†çš„æ°´æœæ²™æ‹‰ï¼Œä»·æ ¼æ˜¯9å…ƒã€‚

å¦‚æœæˆ‘ä»¬çš„æ°´æœæ²™æ‹‰è¿˜å…è®¸å®¢æˆ·æ·»åŠ çŒ•çŒ´æ¡ƒå’Œè¥¿ç“œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸¤ä¸ªæ–°çš„è£…é¥°å™¨ã€‚æ·»åŠ çŒ•çŒ´æ¡ƒè£…é¥°å™¨KiwiDecoratorï¼š

```
public class KiwiDecorator extends AbstractDecorator {

    public KiwiDecorator(AbstractFruitSalad fruitSalad) {
        super(fruitSalad);
    }

    @Override
    public String remark() {
        return super.remark() + "åŠ ä»½ğŸ¥åˆ‡\n";
    }

    @Override
    public int price() {
        return super.price() + 2;
    }
}
```



å¯ä»¥çœ‹åˆ°ï¼ŒåŠ ä¸€ä»½çŒ•çŒ´æ¡ƒéœ€è¦åœ¨åŸæœ‰åŸºç¡€ä¸ŠåŠ 2å…ƒã€‚

æ¥ç€ç»§ç»­åˆ›å»ºè¥¿ç“œè£…é¥°å™¨WaterMelonDecoratorï¼š

```
public class WaterMelonDecorator extends AbstractDecorator {

    public WaterMelonDecorator(AbstractFruitSalad fruitSalad) {
        super(fruitSalad);
    }

    @Override
    public String remark() {
        return super.remark() + "åŠ ä»½ğŸ‰åˆ‡\n";
    }

    @Override
    public int price() {
        return super.price() + 3;
    }
}
```



æœ€ååˆ›å»ºå®¢æˆ·ç«¯Applicationæµ‹è¯•ä¸€ä¸‹ï¼š

```
public class Application {

    public static void main(String[] args) {
        // ç‚¹äº†ä»½æ°´æœæ²™æ‹‰ï¼Œå¹¶åŠ äº†ä¸¤ä»½ğŸ¥å’Œä¸€ä»½ğŸ‰ï¼Œçœ‹çœ‹æœ€ç»ˆä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ
        AbstractFruitSalad fruitSalad = new FruitSalad();
        fruitSalad = new KiwiDecorator(fruitSalad);
        fruitSalad = new KiwiDecorator(fruitSalad);
        fruitSalad = new WaterMelonDecorator(fruitSalad);

        System.out.println(fruitSalad.remark() + "ä»·æ ¼æ˜¯ï¼š" + fruitSalad.price());
    }
}
```



ä¸Šé¢çš„å†™æ³•ä¹Ÿå¯ä»¥æ”¹ä¸ºï¼š

```
public class Application {

    public static void main(String[] args) {
        // ç‚¹äº†ä»½æ°´æœæ²™æ‹‰ï¼Œå¹¶åŠ äº†ä¸¤ä»½ğŸ¥å’Œä¸€ä»½ğŸ‰ï¼Œçœ‹çœ‹æœ€ç»ˆä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ
        AbstractFruitSalad fruitSalad = new FruitSalad();
        fruitSalad = new WaterMelonDecorator(new KiwiDecorator(new KiwiDecorator(fruitSalad)));

        System.out.println(fruitSalad.remark() + "ä»·æ ¼æ˜¯ï¼š" + fruitSalad.price());
    }
}
```



ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š

```
æ°´æœğŸ¥—ï¼ˆæ ‡å‡†ï¼‰
åŠ ä»½ğŸ¥åˆ‡
åŠ ä»½ğŸ¥åˆ‡
åŠ ä»½ğŸ‰åˆ‡
ä»·æ ¼æ˜¯ï¼š16
```



é€šè¿‡ä¸åŒçš„è£…é¥°å™¨è‡ªç”±ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»çš„ç»„è£…å‡ºå„å¼å„æ ·çš„æ°´æœæ²™æ‹‰ï¼Œè¿™æ­£æ˜¯è£…é¥°è€…æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œä½†æ˜æ˜¾å¯ä»¥çœ‹å‡ºä»£ç å˜å¤æ‚äº†ã€‚

è¿™ä¸ªä¾‹å­çš„UMLå›¾å¦‚ä¸‹æ‰€ç¤º:

![QQæˆªå›¾20191218172739.png](https://mrbird.cc/img/QQ%E6%88%AA%E5%9B%BE20191218172739.png)

### é€‚é…å™¨æ¨¡å¼

å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢ä¸ºæœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

é€‚ç”¨äºï¼š

1. å·²å­˜åœ¨çš„ç±»ï¼Œå®ƒçš„æ–¹æ³•å’Œéœ€æ±‚ä¸åŒ¹é…æ—¶ï¼ˆæ–¹æ³•ç»“æœç›¸åŒæˆ–è€…ç›¸ä¼¼ï¼‰

ä¼˜ç‚¹:

1. æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨ï¼Œç°æœ‰çš„ç±»å¤ç”¨ä½†ä¸éœ€æ”¹å˜ï¼›
2. ç›®æ ‡ç±»å’Œé€‚é…å™¨ç±»è§£è€¦ï¼Œæé«˜ç¨‹åºæ‹“å±•æ€§ï¼›
3. ç¬¦åˆå¼€é—­åŸåˆ™ã€‚

ç¼ºç‚¹ï¼š

1. é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ï¼›
2. é™ä½ä»£ç å¯è¯»æ€§ã€‚

åˆ†ä¸ºï¼šç±»é€‚é…å™¨æ¨¡å¼å’Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼ã€‚

å…ˆä¸¾ä¸ªç±»é€‚é…å™¨æ¨¡å¼çš„ä¾‹å­ï¼š

å‡å¦‚é¡¹ç›®é‡ŒåŸæœ‰ä¸€æ¡æ°´æœçš„äº§å“çº¿ï¼Œæ¯”å¦‚åŒ…å«ä¸€ä¸ªæ ‘è“ç±»Raspberryï¼š

```
public class Raspberry {

    public void addRaspberry() {
        System.out.println("æ·»åŠ ç‚¹æ ‘è“");
    }
}
```



éšç€é¡¹ç›®çš„æ‹“å±•ï¼Œç°åœ¨æ–°å¢äº†æ°´æœæ´¾äº§å“çº¿ï¼Œæ–°å»ºPieæ¥å£ï¼š

```
public interface Pie {

    void make();
}
```



è¦å°†RaspberryåŠ å…¥åˆ°Pieäº§å“çº¿ï¼Œåˆä¸æƒ³ä¿®æ”¹Raspberryç±»çš„ä»£ç ï¼Œåˆ™å¯ä»¥åˆ›å»ºä¸€ä¸ªé€‚é…å™¨RaspberryPieAdaptorï¼š

```
public class RaspberryPieAdaptor extends Raspberry implements Pie{
    @Override
    public void make() {
        System.out.println("åˆ¶ä½œä¸€ä¸ªæ´¾ğŸ¥§");
        super.addRaspberry();
    }
}
```



é€‚é…å™¨ç»§æ‰¿è¢«é€‚é…çš„ç±»ï¼Œå®ç°æ–°çš„äº§å“çº¿æ¥å£ã€‚

åœ¨Applicationé‡Œæµ‹è¯•ä¸€æ³¢ï¼š

```
public class Application {
    public static void main(String[] args) {
        Pie pie = new RaspberryPieAdaptor();
        pie.make();
    }
}
```



è¾“å‡ºï¼š

```
åˆ¶ä½œä¸€ä¸ªæ´¾ğŸ¥§
æ·»åŠ ç‚¹æ ‘è“
```



æˆåŠŸé€šè¿‡é€‚é…å™¨åˆ¶é€ äº†æ ‘è“æ´¾ã€‚ç±»é€‚é…å™¨æ¨¡å¼çš„UMLå›¾å¾ˆç®€å•ï¼š

![QQæˆªå›¾20191219105058.png](https://mrbird.cc/img/QQ%E6%88%AA%E5%9B%BE20191219105058.png)

å¯¹è±¡é€‚é…å™¨æ¨¡å¼åªéœ€è¦å°†RaspberryPieAdaptorä¿®æ”¹ä¸ºï¼š

```
public class RaspberryPieAdaptor implements Pie{

    private Raspberry raspberry = new Raspberry();

    @Override
    public void make() {
        System.out.println("åˆ¶ä½œä¸€ä¸ªæ´¾ğŸ¥§");
        raspberry.addRaspberry();
    }
}
```



è¿™ç§æ¨¡å¼ä¸ç›´æ¥ç»§æ‰¿è¢«é€‚é…è€…ï¼Œè€Œæ˜¯åœ¨é€‚é…å™¨é‡Œåˆ›å»ºè¢«é€‚é…è€…ã€‚è¿™ç§æ¨¡å¼çš„UMLå›¾ï¼š

![QQæˆªå›¾20191219110730.png](https://mrbird.cc/img/QQ%E6%88%AA%E5%9B%BE20191219110730.png)

### äº«å…ƒæ¨¡å¼

æä¾›äº†å‡å°‘å¯¹è±¡æ•°é‡ä»è€Œæ”¹å–„åº”ç”¨æ‰€éœ€çš„å¯¹è±¡ç»“æ„çš„æ–¹å¼ï¼Œè¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚

é€‚ç”¨äºï¼š

1. åº•å±‚ç³»ç»Ÿå¼€å‘ï¼Œè§£å†³æ€§èƒ½é—®é¢˜ï¼›
2. ç³»ç»Ÿæ‹¥æœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚

ä¼˜ç‚¹ï¼š

1. å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½å†…å­˜å ç”¨ï¼›

ç¼ºç‚¹ï¼š

1. å…³æ³¨å†…/å¤–éƒ¨çŠ¶æ€ï¼Œå…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›
2. ç¨‹åºçš„é€»è¾‘å¤æ‚åŒ–ã€‚

å†…éƒ¨çŠ¶æ€ï¼šç®€å•ç†è§£ä¸ºäº«å…ƒå¯¹è±¡çš„å±æ€§çŠ¶æ€ï¼Œä¸ä¼šå› ä¸ºå¤–éƒ¨çš„æ”¹å˜è€Œæ”¹å˜ï¼› å¤–éƒ¨çŠ¶æ€ï¼šç®€å•ç†è§£ä¸ºæ–¹æ³•å‚æ•°ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæ–°å»ºæ´¾ğŸ¥§æ¥å£Pieï¼š

```
public interface Pie {

    void make() throws InterruptedException;
}
```



å…¶å®ç°ç±»æ°´æœæ´¾FruitPieï¼š

```
public class FruitPie implements Pie {

    private String name;
    private LocalDateTime productTime;

    public FruitPie(String name) {
        this.name = name;
    }

    public void setProductTime(LocalDateTime productTime) {
        this.productTime = productTime;
    }

    @Override
    public void make() {
        try {
            Thread.sleep(100);
            System.out.println(name + "ç”Ÿäº§æ—¶é—´ï¼š" + this.productTime);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```



åŒ…å«åç§°å’Œç”Ÿäº§æ—¥æœŸå±æ€§ï¼Œå¹¶ä¸”æœ‰ä¸ªmakeæ–¹æ³•ã€‚

æ¥ç€åˆ›å»ºç”Ÿäº§FruitPieçš„å·¥å‚FruitPieFactoryï¼š

```
public class FruitPieFactory {

    private static final HashMap<String, FruitPie> PIE_HASH_MAP = new HashMap<>();

    public static FruitPie produce(String name) {
        FruitPie fruitPie = PIE_HASH_MAP.get(name);
        if (fruitPie == null) {
            System.out.println("æ²¡æœ‰" + name + "åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...");
            fruitPie = new FruitPie(name);
            PIE_HASH_MAP.put(name, fruitPie);
        }
        return fruitPie;
    }
}
```



ä»£ç å…³é”®æ˜¯é€šè¿‡HashMapå­˜å‚¨å¯¹è±¡ã€‚

ç¼–å†™ä¸ªæµ‹è¯•ç±»ï¼š

```
public class Application {

    private static final String[] PIE = {"ğŸ‡æ´¾", "ğŸˆæ´¾", "ğŸ“æ´¾", "ğŸ’æ´¾"};

    public static void main(String[] args) {
        IntStream.range(0, 10).forEach((i) -> {
            String name = PIE[(int) (Math.random() * PIE.length)];
            FruitPie fruitPie = FruitPieFactory.produce(name);
            fruitPie.setProductTime(LocalDateTime.now());
            fruitPie.make();
        });
    }
}
```



è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š

```
æ²¡æœ‰ğŸ“æ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...
ğŸ“æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.397
æ²¡æœ‰ğŸ‡æ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...
ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.498
ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.599
æ²¡æœ‰ğŸ’æ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...
ğŸ’æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.700
ğŸ’æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.800
ğŸ’æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:26.901
æ²¡æœ‰ğŸˆæ´¾åˆ¶ä½œæ–¹æ³•ï¼Œå­¦ä¹ åˆ¶ä½œ...
ğŸˆæ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.002
ğŸ“æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.103
ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.203
ğŸ‡æ´¾ç”Ÿäº§æ—¶é—´ï¼š2019-12-19T16:13:27.304
```



ä»ç»“æœçœ‹ï¼Œåœ¨10æ¬¡å¾ªç¯ä¸­ï¼Œåªç”Ÿäº§äº†4ä¸ªå¯¹è±¡ï¼Œè¿™å¾ˆå¥½çš„æè¿°äº†ç³»ç»Ÿæœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœºæ™¯ã€‚

JDKä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæ•°æ®åº“è¿æ¥æ± ç­‰éƒ½æ˜¯ç”¨çš„äº«å…ƒæ¨¡å¼ã€‚

### ç»„åˆæ¨¡å¼

å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ä¿æŒä¸€è‡´çš„æ–¹å¼å¤„ç†ã€‚

é€‚ç”¨äºï¼š

1. å®¢æˆ·ç«¯å¯ä»¥å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„å·®å¼‚ï¼›
2. å¤„ç†æ ‘å½¢ç»“æ„æ•°æ®ã€‚

ä¼˜ç‚¹:

1. å±‚æ¬¡æ¸…æ™°ï¼›
2. å®¢æˆ·ç«¯ä¸å¿…å…³ç³»å±‚æ¬¡å·®å¼‚ï¼Œæ–¹ä¾¿æ§åˆ¶ï¼›
3. ç¬¦åˆå¼€é—­åŸåˆ™ã€‚

ç¼ºç‚¹ï¼š

1. æ ‘å½¢å¤„ç†è¾ƒä¸ºå¤æ‚ã€‚

ä¸¾ä¸ªèœå•æŒ‰é’®ç»„æˆçš„æ ‘å½¢ä¾‹å­ã€‚

æ–°å»ºèœå•æŒ‰é’®çš„ç»„åˆæŠ½è±¡ç±»AbstractMenuButtonï¼š

```
public abstract class AbstractMenuButton {

    public void add(AbstractMenuButton abstractMenuButton) {
        throw new UnsupportedOperationException("ä¸æ”¯æŒåˆ›å»ºæ“ä½œ");
    }

    public String getName() {
        throw new UnsupportedOperationException("ä¸æ”¯æŒåç§°è·å–");
    }

    public String getType() {
        throw new UnsupportedOperationException("ä¸æ”¯æŒç±»å‹è·å–");
    }

    public String getIcon() {
        throw new UnsupportedOperationException("ä¸æ”¯æŒå›¾æ ‡");
    }

    public void print() {
        throw new UnsupportedOperationException("ä¸æ”¯æŒæ‰“å°æ“ä½œ");
    }
}
```



ç»„åˆäº†èœå•æŒ‰é’®æ“ä½œçš„åŸºæœ¬æ–¹æ³•ã€‚

æ–°å¢æŒ‰é’®ç±»Buttonï¼š

```
public class Button extends AbstractMenuButton {

    private String name;

    public Button(String name) {
        this.name = name;
    }

    @Override
    public String getName() {
        return this.name;
    }

    @Override
    public String getType() {
        return "æŒ‰é’®";
    }

    @Override
    public void print() {
        System.out.println(getName() + "ã€" + getType() + "ã€‘");
    }
}
```



æŒ‰é’®æ‹¥æœ‰åç§°å±æ€§ï¼Œå¹¶ä¸”æ”¯æŒåç§°è·å–ï¼Œç±»å‹è·å–å’Œæ‰“å°æ–¹æ³•ï¼Œæ‰€ä»¥é‡å†™äº†è¿™ä¸‰ä¸ªçˆ¶ç±»æ–¹æ³•ã€‚

æ¥ç€æ–°å»ºèœå•ç±»Menuï¼š

```
public class Menu extends AbstractMenuButton {

    private List<AbstractMenuButton> items = new ArrayList<>();
    private String name;
    private String icon;
    private Integer level;

    public Menu(String name, String icon, Integer level) {
        this.name = name;
        this.icon = icon;
        this.level = level;
    }

    @Override
    public void add(AbstractMenuButton abstractMenuButton) {
        items.add(abstractMenuButton);
    }

    @Override
    public String getName() {
        return this.name;
    }

    @Override
    public String getType() {
        return "èœå•";
    }

    @Override
    public String getIcon() {
        return this.icon;
    }

    @Override
    public void print() {
        System.out.println(getIcon() + getName() + "ã€" + getType() + "ã€‘");
        for (AbstractMenuButton item : items) {
            if (this.level != null) {
                for (int i = 0; i < this.level; i++) {
                    System.out.print("    ");
                }
            }
            item.print();
        }
    }
}
```



èœå•åŒ…å«åç§°ã€å›¾æ ‡å’Œå±‚çº§å±æ€§ï¼Œå¹¶ä¸”èœå•å¯ä»¥åŒ…å«ä¸‹çº§ï¼ˆæ¯”å¦‚ä¸‹çº§èœå•ï¼Œä¸‹çº§æŒ‰é’®ï¼‰ï¼Œæ‰€ä»¥å®ƒåŒ…å«ä¸€ä¸ªListç±»å‹çš„å±æ€§itemsã€‚

æ­¤å¤–ï¼Œèœå•åŒ…å«æ·»åŠ ä¸‹çº§ã€åç§°è·å–ã€ç±»å‹è·å–ã€å›¾æ ‡è·å–å’Œæ‰“å°æ–¹æ³•ã€‚

æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæµ‹è¯•èœå•æŒ‰é’®çš„å±‚çº§ç»“æ„ï¼š

```
public class Application {

    public static void main(String[] args) {
        Menu userMenu = new Menu("ç”¨æˆ·ç®¡ç†", "ğŸ§‘", 2);
        Button createUser = new Button("æ–°å¢ç”¨æˆ·");
        Button updateUser = new Button("ä¿®æ”¹ç”¨æˆ·");
        Button deleteUser = new Button("åˆ é™¤ç”¨æˆ·");
        userMenu.add(createUser);
        userMenu.add(updateUser);
        userMenu.add(deleteUser);

        Menu logMenu = new Menu("æ“ä½œæ—¥å¿—", "ğŸ“ƒ", 2);
        Button export = new Button("å¯¼å‡ºExcel");
        logMenu.add(export);

        Menu systemMenu = new Menu("ç³»ç»Ÿç®¡ç†", "ğŸ”¨", 1);
        systemMenu.add(userMenu);
        systemMenu.add(logMenu);

        systemMenu.print();
    }
}
```



æ‰“å°è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š

```
ğŸ”¨ç³»ç»Ÿç®¡ç†ã€èœå•ã€‘
    ğŸ§‘ç”¨æˆ·ç®¡ç†ã€èœå•ã€‘
        æ–°å¢ç”¨æˆ·ã€æŒ‰é’®ã€‘
        ä¿®æ”¹ç”¨æˆ·ã€æŒ‰é’®ã€‘
        åˆ é™¤ç”¨æˆ·ã€æŒ‰é’®ã€‘
    ğŸ“ƒæ“ä½œæ—¥å¿—ã€èœå•ã€‘
        å¯¼å‡ºExcelã€æŒ‰é’®ã€‘
```



UMLå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![QQæˆªå›¾20191219190427.png](https://mrbird.cc/img/QQ%E6%88%AA%E5%9B%BE20191219190427.png)

### æ¡¥æ¥æ¨¡å¼

å°†æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚é€šè¿‡ç»„åˆçš„æ–¹å¼å»ºç«‹ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ã€‚

é€‚ç”¨äºï¼š

1. æŠ½è±¡å’Œå®ä½“å®ç°ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ï¼›
2. ä¸€ä¸ªç±»å­˜åœ¨å¤šä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œå¹¶ä¸”éœ€è¦ç‹¬ç«‹æ‹“å±•ï¼›
3. ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿ã€‚

ä¼˜ç‚¹ï¼š

1. åˆ†ç¦»æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†ï¼›
2. æé«˜äº†ç³»ç»Ÿå¯æ‹“å±•æ€§ï¼›
3. ç¬¦åˆå¼€é—­åŸåˆ™å’Œåˆæˆå¤ç”¨åŸåˆ™ã€‚

ç¼ºç‚¹ï¼š

1. å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£å’Œè®¾è®¡éš¾åº¦ï¼›

ä¸¾ä¸ªä¾‹å­ï¼š

ç°æœ‰æ´¾çš„æ¥å£ç±»Pieï¼š

```
public interface Pie {

    Pie makePie();

    void getType();
}
```



åŒ…å«åˆ¶ä½œæ´¾å’Œè·å–æ´¾ç±»å‹æŠ½è±¡æ–¹æ³•ã€‚

æ¥ç€åˆ›å»ºä¸¤ä¸ªPieçš„å®ç°ç±»ï¼Œè‹¹æœæ´¾AppliePieï¼š

```
public class ApplePie implements Pie {
    @Override
    public Pie makePie() {
        System.out.println("åˆ¶ä½œè‹¹æœæ´¾ğŸğŸ¥§");
        return new ApplePie();
    }

    @Override
    public void getType() {
        System.out.println("æ°´æœæ´¾");
    }
}
```



èƒ¡èåœæ´¾CarrotPieï¼š

```
public class CarrotPie implements Pie{
    @Override
    public Pie makePie() {
        System.out.println("åˆ¶ä½œèƒ¡èåœæ´¾ğŸ¥•ğŸ¥§");
        return new CarrotPie();
    }

    @Override
    public void getType() {
        System.out.println("è”¬èœæ²™æ‹‰æ´¾");
    }
}
```



æ¥ç€åˆ›å»ºä¸€ä¸ªåº—é“ºæŠ½è±¡ç±»Storeï¼Œé€šè¿‡å±æ€§çš„æ–¹å¼å’ŒPieç›¸å…³è”ï¼Œç›®çš„æ˜¯å¯ä»¥åœ¨ä¸åŒçš„åº—é“ºå®ç°ç±»ä¸­çµæ´»åœ°åˆ¶ä½œå„ç§æ´¾ï¼š

```
public abstract class Store {

    protected Pie pie;

    public Store(Pie pie){
        this.pie = pie;
    }

    abstract Pie makePie();
}
```



Storeå­ç±»ä¹‹ä¸€ï¼Œå±±å§†å¤§å”çš„å°åº—SamStoreï¼š

```
public class SamStore extends Store{

    public SamStore(Pie pie) {
        super(pie);
    }

    @Override
    Pie makePie() {
        System.out.print("å±±å§†å¤§å”çš„å°åº—ğŸ’’");
        return pie.makePie();
    }
}
```



Storeå­ç±»ä¹‹äºŒï¼Œæ°å…‹çš„å°åº—JackStoreï¼š

```
public class JackStore extends Store {

    public JackStore(Pie pie) {
        super(pie);
    }

    @Override
    Pie makePie() {
        System.out.print("æ°å…‹çš„å°åº—ğŸ’’");
        return pie.makePie();
    }
}
```



æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæµ‹è¯•Pieçš„å®ç°ç±»å’ŒStoreçš„ç»§æ‰¿ç±»ä¹‹é—´çš„è‡ªç”±ç»„åˆï¼š

```
public class Application {
    public static void main(String[] args) {
        Store samStore = new SamStore(new ApplePie());
        Pie samStorePie = samStore.makePie();
        samStorePie.getType();

        Store jackStore = new JackStore(new CarrotPie());
        Pie jackStorePie = jackStore.makePie();
        jackStorePie.getType();
    }
}
```



è¾“å‡ºå¦‚ä¸‹ï¼š

```
å±±å§†å¤§å”çš„å°åº—ğŸ’’åˆ¶ä½œè‹¹æœæ´¾ğŸğŸ¥§
æ°´æœæ´¾
æ°å…‹çš„å°åº—ğŸ’’åˆ¶ä½œèƒ¡èåœæ´¾ğŸ¥•ğŸ¥§
è”¬èœæ²™æ‹‰æ´¾
```



è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°ä½“ç°äº†æ¡¥æ¥æ¨¡å¼çš„ç‰¹ç‚¹ï¼ŒUMLå›¾å¦‚ä¸‹ï¼š

![QQæˆªå›¾20191220151943.png](https://mrbird.cc/img/QQ%E6%88%AA%E5%9B%BE20191220151943.png)

### ä»£ç†æ¨¡å¼

ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°äº†ä¸­ä»‹çš„ä½œç”¨ã€‚

é€‚ç”¨äºï¼š

1. ä¿æŠ¤ç›®æ ‡å¯¹è±¡ï¼›
2. å¢å¼ºç›®æ ‡å¯¹è±¡ã€‚

ä¼˜ç‚¹ï¼š

1. å°†ä»£ç†å¯¹è±¡å’ŒçœŸå®è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼›
2. é™ä½è€¦åˆï¼Œæ‹“å±•æ€§å¥½ï¼›
3. ä¿æŠ¤ç›®æ ‡å¯¹è±¡ï¼Œå¢å¼ºç›®æ ‡å¯¹è±¡ã€‚

ç¼ºç‚¹ï¼š

1. é€ æˆç±»çš„æ•°ç›®å¢åŠ ï¼Œå¢åŠ å¤æ‚åº¦ï¼›
2. å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡å¢åŠ ä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆå¤„ç†é€Ÿåº¦å˜æ…¢ã€‚

#### é™æ€ä»£ç†

é€šè¿‡åœ¨ä»£ç ä¸­æ˜¾å¼åœ°å®šä¹‰äº†ä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­é€šè¿‡åŒåçš„æ–¹æ³•å¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è¿›è¡ŒåŒ…è£…ï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚

ä¸¾ä¸ªé™æ€ä»£ç†çš„ä¾‹å­ï¼š

æ–°å»ºä¸€ä¸ªæ´¾çš„åˆ¶ä½œæ¥å£PieServiceï¼š

```
public interface PieServcie {
    void makePie();
}
```



åˆ›å»ºå…¶å®ç°ç±»PieServiceImplï¼š

```
public class PieServiceImpl implements PieServcie{
    public void makePie() {
        System.out.println("åˆ¶ä½œğŸ¥—æ´¾");
    }
}
```



è¦å¯¹PieServiceImplçš„`makePie`æ–¹æ³•å¢å¼ºï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡PieServiceProxyï¼š

```
public class PieServiceProxy {

    private PieServcie pieServcie;

    public void makePie() {
        beforeMethod();
        pieServcie = new PieServiceImpl();
        pieServcie.makePie();
        afterMethod();
    }

    private void beforeMethod() {
        System.out.println("å‡†å¤‡ææ–™");
    }

    private void afterMethod() {
        System.out.println("ä¿é²œ");
    }

}
```



åœ¨PieServiceProxyä¸­æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå’ŒPieServcieä¸€è‡´çš„åŒåæ–¹æ³•`makePie`ï¼Œæ–¹æ³•å†…éƒ¨è°ƒç”¨äº†PieServiceImplçš„`makePie`æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•è°ƒç”¨å‰è°ƒç”¨äº†ä»£ç†ç±»çš„`beforeMethod`æ–¹æ³•ï¼Œæ–¹æ³•è°ƒç”¨åè°ƒç”¨äº†ä»£ç†ç±»çš„`afterMethod`æ–¹æ³•ã€‚

åˆ›å»ºå®¢æˆ·ç«¯Applicationï¼Œæµ‹è¯•ï¼š

```
public class Application {

    public static void main(String[] args) {
        PieServiceProxy proxy = new PieServiceProxy();
        proxy.makePie();
    }
}
```



è¾“å‡ºï¼š

```
å‡†å¤‡ææ–™
åˆ¶ä½œğŸ¥—æ´¾
ä¿é²œ
```



è¿™ä¸ªä¾‹å­çš„UMLå›¾å¦‚ä¸‹ï¼š

![QQ20200421-100633@2x](https://mrbird.cc/img/QQ20200421-100633@2x.png)

#### åŠ¨æ€ä»£ç†

JDKçš„åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ¥å£ï¼Œé€šè¿‡æ¥å£çš„æ–¹æ³•ååœ¨åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¸­è°ƒç”¨ä¸šåŠ¡å®ç°ç±»çš„åŒåæ–¹æ³•ã€‚

é™æ€ä»£ç†çš„ç¼ºç‚¹å°±æ˜¯æ¯éœ€è¦ä»£ç†ä¸€ä¸ªç±»ï¼Œå°±éœ€è¦æ‰‹å†™å¯¹åº”çš„ä»£ç†ç±»ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨åŠ¨æ€ä»£ç†æ¥è§£å†³ã€‚ä¸¾ä¸ªåŠ¨æ€ä»£ç†çš„ä¾‹å­ï¼š

æ–°å»ºå†°æ·‡æ·‹åˆ¶ä½œæ¥å£IceCreamServiceï¼š

```
public interface IceCreamService {
    void makeIceCream(String fruit);
}
```



å®ç°ç±»IceCreamServiceImplï¼š

```
public class IceCreamServiceImpl implements IceCreamService {

    public void makeIceCream(String fruit) {
        System.out.println("åˆ¶ä½œ" + fruit + "ğŸ¦");
    }
}
```



ç°åœ¨éœ€è¦å¯¹IceCreamServiceImplè¿›è¡Œä»£ç†å¢å¼ºï¼Œå¦‚æœä½¿ç”¨é™æ€ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªIceCreamServiceImplProxyç±»ï¼Œä½¿ç”¨åŠ¨æ€ä»£ç†çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€ç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ã€‚

åˆ›å»ºDynamicProxyï¼š

```
public class DynamicProxy implements InvocationHandler {

    // ä»£ç†çš„ç›®æ ‡å¯¹è±¡
    private Object object;

    public DynamicProxy(Object object) {
        this.object = object;
    }

    public Object proxy() {
        Class<?> clazz = object.getClass();
        // ç”Ÿæˆä»£ç†å¯¹è±¡
        return Proxy.newProxyInstance(clazz.getClassLoader(),
                clazz.getInterfaces(), this);
    }

    /**
     * @param proxy  åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡
     * @param method ä»£ç†æ–¹æ³•
     * @param args   ä»£ç†æ–¹æ³•çš„æ–¹æ³•å‚æ•°
     * @return ç»“æœ
     * @throws Throwable
     */
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
       return null;
    }

}
```



åŠ¨æ€ä»£ç†ç±»é€šè¿‡å®ç°InvocationHandlerçš„`invoke`æ–¹æ³•å®ç°ï¼Œ`proxy`ç”¨äºç”Ÿæˆä»£ç†å¯¹è±¡ã€‚å‰©ä¸‹çš„æ­¥éª¤å’Œé™æ€ä»£ç†ç±»ä¼¼ï¼Œå®Œå–„DynamicProxyï¼š

```
public class DynamicProxy implements InvocationHandler {

    // ä»£ç†çš„ç›®æ ‡å¯¹è±¡
    private Object object;

    public DynamicProxy(Object object) {
        this.object = object;
    }

    public Object proxy() {
        Class<?> clazz = object.getClass();
        // ç”Ÿæˆä»£ç†å¯¹è±¡
        return Proxy.newProxyInstance(clazz.getClassLoader(),
                clazz.getInterfaces(), this);
    }

    /**
     * @param proxy  åŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡
     * @param method ä»£ç†æ–¹æ³•
     * @param args   ä»£ç†æ–¹æ³•çš„æ–¹æ³•å‚æ•°
     * @return ç»“æœ
     * @throws Throwable
     */
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        beforeMethod(object);
        // åå°„æ‰§è¡Œä»£ç†å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•
        Object result = method.invoke(object, args);
        afterMethod(object);
        return result;
    }

    private void beforeMethod(Object object) {
        if (object instanceof PieServcie) {
            System.out.println("å‡†å¤‡æ´¾çš„ææ–™");
        } else if (object instanceof IceCreamService) {
            System.out.println("å‡†å¤‡å†°æ·‡æ·‹ææ–™");
        } else {
            throw new RuntimeException("æš‚ä¸æ”¯æŒä»£ç†" + object.getClass() + "ç±»å‹");
        }
    }

    private void afterMethod(Object object) {
        if (object instanceof PieServcie) {
            System.out.println("ä¿é²œæ´¾");
        } else if (object instanceof IceCreamService) {
            System.out.println("ä¿é²œå†°æ·‡æ·‹");
        } else {
            throw new RuntimeException("æš‚ä¸æ”¯æŒä»£ç†" + object.getClass() + "ç±»å‹");
        }
    }

}
```

åˆ›å»ºå®¢æˆ·ç«¯Applicationæµ‹è¯•ï¼š

```
public class Application {

    public static void main(String[] args) {

        PieServcie pieServiceDynamicProxy = (PieServcie) new DynamicProxy(new PieServiceImpl()).proxy();
        pieServiceDynamicProxy.makePie();
        System.out.println("-----------------");
        IceCreamService iceCreamServiceDynamicProxy = (IceCreamService) new DynamicProxy(new IceCreamServiceImpl()).proxy();
        iceCreamServiceDynamicProxy.makeIceCream("ğŸ“");
    }
}
```



ç»“æœï¼š

```
å‡†å¤‡æ´¾çš„ææ–™
åˆ¶ä½œğŸ¥—æ´¾
ä¿é²œæ´¾
-----------------
å‡†å¤‡å†°æ·‡æ·‹ææ–™
åˆ¶ä½œğŸ“ğŸ¦
ä¿é²œå†°æ·‡æ·‹
```



å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æˆ‘ä»¬å®ç°äº†ç›®æ ‡æ–¹æ³•å¢å¼ºï¼Œå¹¶ä¸”ä¸éœ€è¦æ‰‹å†™ç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚

#### CGLibä»£ç†

é€šè¿‡ç»§æ‰¿æ¥å®ç°ï¼Œç”Ÿæˆçš„ä»£ç†ç±»å°±æ˜¯ç›®æ ‡å¯¹è±¡ç±»çš„å­ç±»ï¼Œé€šè¿‡é‡å†™ä¸šåŠ¡æ–¹æ³•æ¥å®ç°ä»£ç†ã€‚

#### Springå¯¹ä»£ç†æ¨¡å¼çš„æ‹“å±•

1. å½“Beanæœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼›
2. å½“Beanæ²¡æœ‰å®ç°æ¥å£æ—¶ï¼Œä½¿ç”¨CGLibä»£ç†ã€‚

å¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å¼ºåˆ¶ä½¿ç”¨CGLibä»£ç†ï¼š

```
spring:
  aop:
    proxy-target-class: true
```

